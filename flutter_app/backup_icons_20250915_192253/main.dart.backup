// Materialå¯¼å…¥å·²ç§»é™¤ï¼Œä½¿ç”¨çº¯Cupertinoæ¶æ„
import 'core/network/supabase_client.dart';
import 'core/di/injection_container.dart' as di;
import 'core/security/secure_storage_service.dart';
import 'core/utils/logger.dart';
import 'core/config/app_config.dart';
import 'app.dart';

void main() async {
  // ç¡®ä¿Flutter bindingåˆå§‹åŒ–
  WidgetsFlutterBinding.ensureInitialized();

  try {
    // åˆå§‹åŒ–ä¾èµ–æ³¨å…¥å®¹å™¨
    await di.init();

    // ğŸ” å®‰å…¨å¢å¼ºï¼šåˆå§‹åŒ–å®‰å…¨å­˜å‚¨æœåŠ¡
    try {
      await SecureStorageService.initialize();
      if (AppConfig.enableLogging) {
        AppLogger.info('âœ… å®‰å…¨å­˜å‚¨æœåŠ¡åˆå§‹åŒ–æˆåŠŸ', tag: 'Security');
      }
    } catch (e) {
      if (AppConfig.enableLogging) {
        AppLogger.error('ğŸš¨ å®‰å…¨å­˜å‚¨æœåŠ¡åˆå§‹åŒ–å¤±è´¥', tag: 'Security', error: e);
      }
      // å¦‚æœå®‰å…¨å­˜å‚¨åˆå§‹åŒ–å¤±è´¥ï¼Œç»§ç»­è¿è¡Œä½†è®°å½•è­¦å‘Š
    }

    // åˆå§‹åŒ–Supabaseå®¢æˆ·ç«¯
    await SupabaseClientManager.initialize();

  } catch (e) {
    if (AppConfig.enableLogging) {
      AppLogger.error('ğŸš¨ åº”ç”¨åˆå§‹åŒ–å¤±è´¥', tag: 'App', error: e);
    }
  }

  runApp(
    const InvoiceAssistantApp(),
  );
}
