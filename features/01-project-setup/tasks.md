# 功能任务：01-项目基础架构

## 概述
建立 Flutter iOS 应用的完整基础架构，包括项目初始化、Supabase 集成、主题系统和状态管理配置。

## 任务分类

### 类别 1：项目初始化和基础配置
**优先级**: 高
**总估算**: 4-6 小时

#### 任务 1.1：创建 Flutter 项目
- **描述**: 在 `invoice-assistant-v2/flutter_app/` 目录下创建新的 Flutter 项目
- **验收标准**:
  - [ ] 使用 `flutter create flutter_app --org com.invoiceassist` 命令创建项目
  - [ ] 项目包名配置为 `com.invoiceassist.flutter`
  - [ ] iOS 最低版本设置为 15.0
  - [ ] 项目可以正常运行在 iOS 模拟器和 Web 浏览器
- **依赖**: 无
- **估算**: 1 小时
- **负责人**: 待定

#### 任务 1.2：配置 pubspec.yaml 依赖
- **描述**: 添加所有必需的 Flutter 依赖包
- **验收标准**:
  - [ ] 添加 `supabase_flutter` 最新版本
  - [ ] 添加 `flex_color_scheme` 最新版本
  - [ ] 添加 `go_router` 最新版本
  - [ ] 添加 `flutter_riverpod` 最新版本
  - [ ] 添加 `connectivity_plus` 最新版本
  - [ ] 添加开发依赖 `flutter_lints` 和 `build_runner`
  - [ ] 运行 `flutter pub get` 成功
- **依赖**: 任务 1.1
- **估算**: 0.5 小时
- **负责人**: 待定

#### 任务 1.3：创建项目目录结构
- **描述**: 按照设计文档创建完整的项目目录结构
- **验收标准**:
  - [ ] 创建 `lib/core/` 目录及子目录
  - [ ] 创建 `lib/features/` 目录及各功能模块目录
  - [ ] 创建 `lib/shared/` 目录及子目录
  - [ ] 创建 `assets/` 目录结构
  - [ ] 目录结构与设计文档完全一致
- **依赖**: 任务 1.1
- **估算**: 0.5 小时
- **负责人**: 待定

#### 任务 1.4：配置 iOS 项目设置
- **描述**: 配置 iOS 原生项目设置以支持应用功能
- **验收标准**:
  - [ ] 更新 `ios/Runner/Info.plist` 中的应用信息
  - [ ] 设置应用图标和启动画面占位符
  - [ ] 配置相机和相册权限描述
  - [ ] 设置网络权限配置
  - [ ] iOS 项目可以正常编译和运行
- **依赖**: 任务 1.1
- **估算**: 1 小时
- **负责人**: 待定

### 类别 2：核心配置和服务
**优先级**: 高
**总估算**: 6-8 小时

#### 任务 2.1：创建应用配置文件
- **描述**: 创建 `lib/core/config/app_config.dart` 应用配置文件
- **验收标准**:
  - [ ] 定义应用基础配置常量
  - [ ] 支持环境变量读取（复用现有 Supabase 配置）
  - [ ] 提供配置验证方法
  - [ ] 包含调试模式开关
- **依赖**: 任务 1.3
- **估算**: 1 小时
- **负责人**: 待定

#### 任务 2.2：创建 Supabase 配置文件
- **描述**: 创建 `lib/core/config/supabase_config.dart` 文件，复用现有配置
- **验收标准**:
  - [ ] 使用与前端相同的 `VITE_SUPABASE_URL` 和 `VITE_SUPABASE_ANON_KEY`
  - [ ] 配置认证选项（autoRefreshToken, persistSession 等）
  - [ ] 添加环境验证逻辑
  - [ ] 提供配置状态检查方法
- **依赖**: 任务 2.1
- **估算**: 1.5 小时
- **负责人**: 待定

#### 任务 2.3：创建 Supabase 客户端封装
- **描述**: 创建 `lib/core/network/supabase_client.dart` 客户端封装
- **验收标准**:
  - [ ] 实现 Supabase 客户端初始化
  - [ ] 提供单例模式访问
  - [ ] 实现基础 CRUD 操作接口
  - [ ] 添加错误处理和重试机制
  - [ ] 客户端可以正常连接到现有数据库
- **依赖**: 任务 2.2
- **估算**: 2 小时
- **负责人**: 待定

#### 任务 2.4：创建网络状态检查服务
- **描述**: 创建 `lib/core/network/network_info.dart` 网络检查服务
- **验收标准**:
  - [ ] 实现网络连接状态检测
  - [ ] 提供连接状态流监听
  - [ ] 支持网络连接类型识别
  - [ ] 添加网络变化事件通知
- **依赖**: 任务 1.2
- **估算**: 1.5 小时
- **负责人**: 待定

### 类别 3：UI 框架和主题系统
**优先级**: 中
**总估算**: 4-6 小时

#### 任务 3.1：创建 FlexColorScheme 主题配置
- **描述**: 创建 `lib/core/theme/app_theme.dart` 主题配置文件
- **验收标准**:
  - [ ] 配置 FlexColorScheme 标准配色方案
  - [ ] 定义亮色主题 (lightTheme)
  - [ ] 定义暗色主题 (darkTheme)
  - [ ] 配置 Material Design 3.0 组件样式
  - [ ] 添加 iOS 风格适配设置
- **依赖**: 任务 1.2
- **估算**: 2 小时
- **负责人**: 待定

#### 任务 3.2：创建主题常量文件
- **描述**: 创建 `lib/core/theme/theme_constants.dart` 主题常量定义
- **验收标准**:
  - [ ] 定义颜色常量
  - [ ] 定义字体大小和样式常量
  - [ ] 定义间距和尺寸常量
  - [ ] 定义组件样式常量
- **依赖**: 任务 3.1
- **估算**: 1 小时
- **负责人**: 待定

#### 任务 3.3：创建主题状态管理 Provider
- **描述**: 创建 `lib/shared/providers/theme_provider.dart` 主题状态管理
- **验收标准**:
  - [ ] 使用 Riverpod 实现主题状态管理
  - [ ] 支持亮色/暗色主题切换
  - [ ] 实现主题持久化存储
  - [ ] 提供主题变更通知
- **依赖**: 任务 3.1
- **估算**: 1.5 小时
- **负责人**: 待定

### 类别 4：路由和状态管理
**优先级**: 中
**总估算**: 6-8 小时

#### 任务 4.1：创建应用路由配置
- **描述**: 创建 `lib/core/router/app_router.dart` 路由配置文件
- **验收标准**:
  - [ ] 使用 go_router 配置应用路由
  - [ ] 定义底部导航的4个主要路由
  - [ ] 配置用户中心子页面路由
  - [ ] 添加路由守卫和权限检查
  - [ ] 实现深度链接支持
- **依赖**: 任务 1.2
- **估算**: 2.5 小时
- **负责人**: 待定

#### 任务 4.2：创建底部导航组件
- **描述**: 创建 `lib/shared/widgets/bottom_navigation.dart` 底部导航组件
- **验收标准**:
  - [ ] 实现4个主要导航标签
  - [ ] 配置导航图标和标签文字
  - [ ] 实现页面切换逻辑
  - [ ] 添加当前页面高亮显示
  - [ ] 支持 iPhone 安全区域适配
- **依赖**: 任务 4.1, 任务 3.1
- **估算**: 2 小时
- **负责人**: 待定

#### 任务 4.3：创建认证状态管理 Provider
- **描述**: 创建 `lib/shared/providers/auth_provider.dart` 认证状态管理
- **验收标准**:
  - [ ] 使用 Riverpod 管理用户认证状态
  - [ ] 监听 Supabase 认证状态变化
  - [ ] 提供登录/登出方法
  - [ ] 实现用户信息缓存
  - [ ] 添加认证状态持久化
- **依赖**: 任务 2.3
- **估算**: 2 小时
- **负责人**: 待定

#### 任务 4.4：创建网络状态管理 Provider
- **描述**: 创建 `lib/shared/providers/network_provider.dart` 网络状态管理
- **验收标准**:
  - [ ] 集成网络检查服务
  - [ ] 提供网络状态实时监听
  - [ ] 实现网络重连逻辑
  - [ ] 添加离线模式支持
- **依赖**: 任务 2.4
- **估算**: 1.5 小时
- **负责人**: 待定

### 类别 5：应用框架和入口
**优先级**: 中
**总估算**: 4-5 小时

#### 任务 5.1：创建应用根组件
- **描述**: 创建 `lib/app.dart` 应用根组件
- **验收标准**:
  - [ ] 集成 FlexColorScheme 主题系统
  - [ ] 配置 go_router 路由
  - [ ] 集成 Riverpod 状态管理
  - [ ] 添加全局错误处理
  - [ ] 实现应用级别的状态初始化
- **依赖**: 任务 3.1, 任务 4.1
- **估算**: 2 小时
- **负责人**: 待定

#### 任务 5.2：更新应用入口文件
- **描述**: 更新 `lib/main.dart` 应用入口文件
- **验收标准**:
  - [ ] 实现应用启动序列
  - [ ] 添加网络连接检查
  - [ ] 初始化 Supabase 客户端
  - [ ] 验证用户登录状态
  - [ ] 加载用户首选项设置
  - [ ] 添加启动错误处理
- **依赖**: 任务 5.1, 任务 2.3, 任务 4.3
- **估算**: 2 小时
- **负责人**: 待定

### 类别 6：基础 UI 组件
**优先级**: 低
**总估算**: 3-4 小时

#### 任务 6.1：创建加载组件
- **描述**: 创建 `lib/shared/widgets/loading_widget.dart` 加载组件
- **验收标准**:
  - [ ] 实现统一的加载指示器
  - [ ] 支持不同大小和样式
  - [ ] 添加加载文字提示
  - [ ] 适配主题颜色
- **依赖**: 任务 3.1
- **估算**: 1 小时
- **负责人**: 待定

#### 任务 6.2：创建错误显示组件
- **描述**: 创建 `lib/shared/widgets/error_widget.dart` 错误显示组件
- **验收标准**:
  - [ ] 实现统一的错误显示界面
  - [ ] 支持重试按钮
  - [ ] 添加友好的错误信息
  - [ ] 支持不同错误类型显示
- **依赖**: 任务 3.1
- **估算**: 1.5 小时
- **负责人**: 待定

#### 任务 6.3：创建工具类文件
- **描述**: 创建 `lib/core/utils/` 目录下的工具类文件
- **验收标准**:
  - [ ] 创建 `logger.dart` 日志工具
  - [ ] 创建 `validators.dart` 验证工具
  - [ ] 创建常量定义文件
  - [ ] 添加通用辅助方法
- **依赖**: 任务 1.3
- **估算**: 1.5 小时
- **负责人**: 待定

### 类别 7：测试和验证
**优先级**: 低
**总估算**: 4-6 小时

#### 任务 7.1：创建基础单元测试
- **描述**: 为核心组件创建基础单元测试
- **验收标准**:
  - [ ] 测试 Supabase 客户端初始化
  - [ ] 测试主题状态管理
  - [ ] 测试认证状态管理
  - [ ] 测试网络状态管理
  - [ ] 所有测试可以正常运行
- **依赖**: 类别 2, 3, 4 完成
- **估算**: 3 小时
- **负责人**: 待定

#### 任务 7.2：创建集成测试
- **描述**: 创建应用启动和基础流程的集成测试
- **验收标准**:
  - [ ] 测试应用启动流程
  - [ ] 测试底部导航切换
  - [ ] 测试主题切换功能
  - [ ] 测试网络状态变化
- **依赖**: 任务 7.1
- **估算**: 2 小时
- **负责人**: 待定

#### 任务 7.3：功能验证和调试
- **描述**: 全面验证所有基础功能是否正常工作
- **验收标准**:
  - [ ] iOS 模拟器运行正常
  - [ ] Web 浏览器运行正常
  - [ ] Supabase 连接正常
  - [ ] 主题切换正常
  - [ ] 底部导航正常
  - [ ] 错误处理正常
- **依赖**: 所有前序任务完成
- **估算**: 2 小时
- **负责人**: 待定

## 任务依赖关系图
```
任务 1.1 (创建项目) 
├── 任务 1.2 (配置依赖)
├── 任务 1.3 (目录结构) → 任务 2.1 (应用配置)
└── 任务 1.4 (iOS设置)

任务 2.1 → 任务 2.2 (Supabase配置) → 任务 2.3 (客户端封装) → 任务 4.3 (认证Provider)
任务 1.2 → 任务 2.4 (网络检查) → 任务 4.4 (网络Provider)
任务 1.2 → 任务 3.1 (主题配置) → 任务 3.2 → 任务 3.3 (主题Provider)
任务 1.2 → 任务 4.1 (路由配置) → 任务 4.2 (底部导航)

任务 3.1 + 任务 4.1 → 任务 5.1 (应用根组件)
任务 5.1 + 任务 2.3 + 任务 4.3 → 任务 5.2 (入口文件)
```

## 总估算
- **总工作时间**: 27-37 小时
- **建议完成时间**: 4-5 个工作日
- **团队建议**: 1-2 个开发者并行开发

## 风险和注意事项
1. **Supabase 配置**: 确保正确复用现有环境变量
2. **iOS 权限**: 相机和相册权限配置必须正确
3. **依赖冲突**: 使用最新版本可能存在兼容性问题
4. **测试设备**: 确保有 iOS 15+ 的测试设备或模拟器