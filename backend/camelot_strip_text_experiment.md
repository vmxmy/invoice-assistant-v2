# Camelot strip_text参数实验报告

## 实验背景
用户建议使用`strip_text`参数去除不需要的字符（空格、点和换行符），以改善表格提取效果。

## 实验设置

### 测试1：strip_text=' \n'（同时去除空格和换行符）
```python
tables = camelot.read_pdf(pdf_path, flavor='stream', pages='1', strip_text=' \n')
```

### 测试2：strip_text='\n'（只去除换行符）
```python
tables = camelot.read_pdf(pdf_path, flavor='stream', pages='1', strip_text='\n')
```

## 实验结果

### 原始方法（不使用strip_text）
- 发票号码提取率：28/28 (100%)
- 单元格内容示例：`发票号码：\n25432000000022020617`
- 优点：字段分隔清晰，提取准确率高
- 缺点：单元格内包含换行符

### 使用strip_text后的问题

1. **发票号码提取率下降**
   - 从100%降至85.7%（24/28）
   - 原因：某些发票号码与其他文本合并，导致正则匹配失败

2. **销售方识别错误**
   - 示例：销售方被识别为"杭州趣链科技有限公司"（实际是采购方）
   - 原因：去除分隔符后，不同字段的文本被合并

3. **税率识别异常**
   - 示例：税率从"1%"变成"621%"
   - 原因：相邻单元格的数字被合并

## 分析

### strip_text的副作用
1. **文本合并问题**：去除空格和换行符后，原本分隔的内容被错误合并
2. **字段边界丢失**：发票中很多字段依赖空格和换行符作为分隔标识
3. **正则匹配失效**：合并后的文本可能不符合预期的正则表达式模式

### 为什么不适合发票场景
1. **发票格式特殊性**：中文发票的字段标签和值经常在同一单元格，用换行符分隔
2. **空格的重要性**：中文文本中的空格往往是有意义的分隔符
3. **数据完整性**：保留原始格式有助于准确识别字段边界

## 结论

对于中文发票提取场景，**不建议使用strip_text参数**，原因如下：

1. **准确性优先**：保持原始格式能获得更高的提取准确率
2. **后处理更灵活**：在提取后再处理换行符，可以根据具体情况定制处理逻辑
3. **避免信息丢失**：保留所有分隔符有助于理解文档结构

## 建议的处理方式

```python
# 1. 保持原始提取
tables = camelot.read_pdf(pdf_path, flavor='stream', pages='1')

# 2. 在需要时对特定字段进行后处理
if '\n' in invoice_number:
    invoice_number = invoice_number.replace('\n', '')
```

这种方式能够在保持高准确率的同时，灵活处理格式问题。