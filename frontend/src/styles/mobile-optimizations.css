/* ===========================================
   移动端优化样式
   确保所有触控目标符合44x44px最小标准
   ========================================= */

/* ===========================================
   全局移动端触控优化
   ========================================= */
@layer utilities {
  /* 确保所有交互元素满足44px最小触控区域 */
  @media (hover: none) and (pointer: coarse) {
    /* 按钮优化 - 所有尺寸按钮在移动端都应达到44px */
    .btn-xs, 
    .btn-sm {
      min-height: 44px !important;
      min-width: 44px !important;
      padding-left: 12px;
      padding-right: 12px;
    }
    
    /* 标准按钮也要确保 */
    .btn {
      min-height: 44px !important;
      padding-left: 16px;
      padding-right: 16px;
    }
    
    /* 图标按钮特殊处理 */
    .btn-circle,
    .btn-square {
      width: 44px !important;
      height: 44px !important;
      min-width: 44px !important;
      min-height: 44px !important;
    }
    
    /* 复选框和单选框 */
    .checkbox,
    .radio {
      width: 24px !important;
      height: 24px !important;
      min-width: 24px !important;
      min-height: 24px !important;
    }
    
    /* 为复选框/单选框容器添加额外的点击区域 */
    .checkbox-wrapper,
    .radio-wrapper,
    label:has(.checkbox),
    label:has(.radio) {
      position: relative;
      padding: 10px;
      margin: -10px;
      min-height: 44px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }
    
    /* 下拉菜单项 */
    .dropdown-content li > *,
    .menu li > * {
      min-height: 44px !important;
      padding-top: 12px !important;
      padding-bottom: 12px !important;
    }
    
    /* 输入框 */
    .input-sm,
    .select-sm,
    .textarea-sm {
      min-height: 44px !important;
    }
    
    /* 标签页 */
    .tabs .tab {
      min-height: 44px !important;
      padding-left: 16px;
      padding-right: 16px;
    }
    
    /* 分页按钮 */
    .join .btn {
      min-height: 44px !important;
      min-width: 44px !important;
    }
    
    /* 徽章可点击时 */
    .badge[onclick],
    .badge[role="button"],
    .badge.cursor-pointer {
      min-height: 32px !important;
      padding: 8px 12px !important;
    }
    
    /* 链接和可点击元素 */
    a:not(.btn),
    [role="button"]:not(.btn),
    [onclick]:not(.btn) {
      position: relative;
      display: inline-block;
      min-height: 44px;
      min-width: 44px;
      padding: 10px;
      margin: -10px;
    }
    
    /* 卡片中的小图标按钮（如三点菜单） */
    .card [role="button"] svg,
    .card [onclick] svg {
      padding: 12px;
      margin: -12px;
      min-width: 44px;
      min-height: 44px;
    }
  }
  
  /* 通用触控安全类 */
  .touch-safe {
    min-height: 44px !important;
    min-width: 44px !important;
  }
  
  /* 移动端卡片间距优化 */
  @media (max-width: 640px) {
    .card-body {
      padding: 16px !important;
    }
    
    .card + .card {
      margin-top: 12px;
    }
  }
}

/* ===========================================
   批量操作栏移动端优化
   ========================================= */
@layer components {
  /* 移动端底部固定操作栏 */
  @media (max-width: 768px) {
    .bulk-action-bar {
      position: fixed !important;
      bottom: 0;
      left: 0;
      right: 0;
      z-index: 40;
      background: oklch(var(--b1));
      border-top: 1px solid oklch(var(--bc) / 0.1);
      padding: 12px 16px;
      box-shadow: 0 -4px 6px -1px oklch(0 0 0 / 0.1);
      
      /* 安全区域适配 (iPhone X+) */
      padding-bottom: calc(12px + env(safe-area-inset-bottom));
    }
    
    /* 当批量操作栏显示时，给内容区域添加底部间距 */
    .has-bulk-actions {
      padding-bottom: calc(72px + env(safe-area-inset-bottom)) !important;
    }
    
    /* 批量操作按钮组 */
    .bulk-action-buttons {
      display: flex;
      gap: 8px;
      justify-content: space-between;
      align-items: center;
    }
    
    .bulk-action-buttons .btn {
      flex: 1;
      min-height: 44px !important;
    }
    
    /* 选中计数 */
    .bulk-action-count {
      font-size: 14px;
      font-weight: 500;
      color: oklch(var(--bc) / 0.7);
      white-space: nowrap;
    }
  }
}

/* ===========================================
   发票卡片移动端优化
   ========================================= */
@layer components {
  @media (max-width: 640px) {
    /* 发票卡片触控优化 */
    .invoice-card {
      position: relative;
      margin-bottom: 12px;
    }
    
    /* 卡片内的操作按钮增大触控区域 */
    .invoice-card .dropdown label[role="button"] {
      padding: 12px !important;
      margin: -8px !important;
      min-width: 44px !important;
      min-height: 44px !important;
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;
    }
    
    /* 状态切换按钮 */
    .invoice-card .status-toggle {
      min-height: 36px !important;
      padding: 8px 12px !important;
    }
    
    /* 选择框容器优化 */
    .invoice-card .checkbox-wrapper {
      padding: 10px;
      margin: -10px;
      min-width: 44px;
      min-height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
  }
}

/* ===========================================
   响应式工具类
   ========================================= */
@layer utilities {
  /* 移动端显示/隐藏 */
  @media (max-width: 640px) {
    .hide-mobile { 
      display: none !important; 
    }
    .show-mobile { 
      display: block !important; 
    }
    .show-mobile-flex { 
      display: flex !important; 
    }
  }
  
  @media (min-width: 641px) {
    .hide-desktop { 
      display: none !important; 
    }
    .show-desktop { 
      display: block !important; 
    }
    .show-desktop-flex { 
      display: flex !important; 
    }
  }
  
  /* 移动端文本大小调整 */
  @media (max-width: 640px) {
    .text-mobile-sm {
      font-size: 0.875rem !important;
    }
    .text-mobile-xs {
      font-size: 0.75rem !important;
    }
  }
}

/* ===========================================
   滑动手势视觉反馈
   ========================================= */
@layer components {
  /* 滑动时的视觉反馈 */
  .swipe-active {
    transform: translateX(var(--swipe-distance, 0));
    transition: transform 0.2s ease-out;
  }
  
  .swipe-left {
    background: linear-gradient(to right, transparent, oklch(var(--er) / 0.1));
  }
  
  .swipe-right {
    background: linear-gradient(to left, transparent, oklch(var(--su) / 0.1));
  }
  
  /* 长按效果 */
  .long-press-active {
    animation: longPressRipple 0.6s ease-out;
  }
  
  @keyframes longPressRipple {
    0% {
      box-shadow: 0 0 0 0 oklch(var(--p) / 0.4);
    }
    100% {
      box-shadow: 0 0 0 10px oklch(var(--p) / 0);
    }
  }
}

/* ===========================================
   安全区域适配 (iOS)
   ========================================= */
@supports (padding: env(safe-area-inset-bottom)) {
  .safe-bottom {
    padding-bottom: env(safe-area-inset-bottom);
  }
  
  .safe-top {
    padding-top: env(safe-area-inset-top);
  }
  
  .safe-left {
    padding-left: env(safe-area-inset-left);
  }
  
  .safe-right {
    padding-right: env(safe-area-inset-right);
  }
}